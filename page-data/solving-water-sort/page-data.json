{"componentChunkName":"component---src-templates-blog-post-js","path":"/solving-water-sort/","result":{"data":{"site":{"siteMetadata":{"title":"Living Life on the Outside","author":"Lucian Buzzo"}},"markdownRemark":{"id":"415c6236-9d3a-5577-8980-876b51e387ae","excerpt":"There is a puzzle game that I enjoy playing called “water sort”, and it involves sorting colored liquids into containers. There are a lot of…","html":"<p>There is a puzzle game that I enjoy playing called “water sort”, and it involves sorting colored liquids into containers. There are a lot of different versions out there and you can probably find several different versions for iOS and Android and <a href=\"1\">even browser based</a>\nThe game is simple, but it can be difficult to solve. I thought it would be a fun project to try and write a program that can solve the game for me.</p>\n<p>In water sort, you have a set of containers with different colored liquids in them. The goal is to sort the liquids into containers of the same color. You can only move one liquid at a time, and you can only move a liquid onto an empty container or onto a container with the same color liquid in it.\nEach container holds at maximum 4 units of liquid.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6149aeff6f5d629f6d589a683a1b1a1b/2f8cb/3-flask-problem.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.94594594594595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB8UlEQVR42lWSaVPTUBSG89P1mx/8Abjg8kXHccYR98JQEMQB20oJqZKWlkJrsCylS5LeJbmPpy1udybbk3Pee897jjdKYDR2oCKMzYCcOIXBWF4xWGvJsww3/coldmixRlie45zDGMNolKG1EZbhNUrH+IU9moUCSumpCs1Km93lkMMWTJQEi1A+7JK291hchHGcYyXZygF0lvPwPlz0mW3qNXcO8N9s478sokVwCpulkOrSFsFSkclFhMsnnAQnlJ5vUnu1QnouzI7oRRO2Cj2C12vE5Re4zjae6tS4DKqUPycYlc4EdVSn7+9QKYM9WJY6O5h+j6vqJ8pfcnS4DldNbDxkWHpLpZST7q/Ajx08/lnu+vp9/8Mc//35y+ZLTf275l6WWeLY0Gg47GmAmwzJxPA00TTqFmXnSYN+RrtlyKwW3+bJiXh5WNdY8VFpSyZPT/rEWU/PzHYfb6G6vhCpaOBYfCC716TkQcBXH54+mYubxjrubJfmMdy7OyWXqGQk3Vdzwd6pZmFBOrl6g/ysjot/chX6LDwSwQ83Idqg3Ziw8cznMBJWvA2td3IQWH1cobW2Qbp5B1d/jzednSSxhKGcMNrFaRnMYQfdDQhlbLJoH5fKTKTn5FGVmsTZ0+8Qi5oZzxrxTZjqHkhZR/wCOp2gdbND2RkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3 flask problem\"\n        title=\"\"\n        src=\"/static/6149aeff6f5d629f6d589a683a1b1a1b/fcda8/3-flask-problem.png\"\n        srcset=\"/static/6149aeff6f5d629f6d589a683a1b1a1b/12f09/3-flask-problem.png 148w,\n/static/6149aeff6f5d629f6d589a683a1b1a1b/e4a3f/3-flask-problem.png 295w,\n/static/6149aeff6f5d629f6d589a683a1b1a1b/fcda8/3-flask-problem.png 590w,\n/static/6149aeff6f5d629f6d589a683a1b1a1b/efc66/3-flask-problem.png 885w,\n/static/6149aeff6f5d629f6d589a683a1b1a1b/c83ae/3-flask-problem.png 1180w,\n/static/6149aeff6f5d629f6d589a683a1b1a1b/2f8cb/3-flask-problem.png 1689w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><em>The example above shows the solution to a problem with 3 flasks and two colors. You can see that the problem is solved by pouring the liquids back and forth until we end up with two containers of the same color.</em></p>\n<p>My first step is to represent the problem as a data structure. To do this, I assign each color to a constant, and then arrange those constant values in an array to represent a container. The beginning of the array represents the bottom of the container, and the end of the array represents the top of the container. Empty containers are represented by an empty array.\nI then add the containers to an array to represent the entire problem.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token constant\">BLUE</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">ORANGE</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n\n<span class=\"token keyword\">const</span> problem <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token constant\">ORANGE</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">BLUE</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ORANGE</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">BLUE</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">BLUE</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ORANGE</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">BLUE</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ORANGE</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>By representing the problem as a data structure, I can easily manipulate it with code. For example, I can move a liquid from one container to another by removing it from the end of one array and adding it to the end of another array. I can also check if a container is empty by checking if its array is empty. Because the game has a concept of “pouring” liquids on top of each other, you never add to the beginning of the array or modify a value other than the last one, making this a simple data structure to work with.</p>\n<p>Before I can write code that will solve the problem, I need to some utility functions. The first one is <code class=\"language-text\">isSolved</code>, which checks if the problem is solved. This is done by checking if all the containers are empty or if all the containers have the same color liquid in them.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">isSolved</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">containers</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> containers<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// If any container is not empty and not full, the problem is not solved</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>containers<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">!==</span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> containers<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">!==</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// If the container contains at least two colors that are not the same, the problem is not solved</span>\n    <span class=\"token keyword\">const</span> color <span class=\"token operator\">=</span> containers<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>containers<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">some</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">c</span> <span class=\"token operator\">=></span> c <span class=\"token operator\">!==</span> color<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// If none of the above conditions are met, the problem is solved</span>\n  <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I’ll also need a function for pouring one container into another. This is done by removing the last element from one container and adding it to the end of another container. Pouring continues until the source container is empty, another color is reached, or the destination container is full.\nFor the condition where we continue pouring units of the same color, I simply call the function recursively.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">pour</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">containers<span class=\"token punctuation\">,</span> source<span class=\"token punctuation\">,</span> target</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// If the source container is empty, there is nothing to pour</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>containers<span class=\"token punctuation\">[</span>source<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> containers\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// If the target container is full, there is nothing to pour</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>containers<span class=\"token punctuation\">[</span>target<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> containers\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// Create a simple copy of the containers array</span>\n  <span class=\"token keyword\">const</span> newcontainers <span class=\"token operator\">=</span> containers<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">tube</span> <span class=\"token operator\">=></span> tube<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// Remove the last element from the source container</span>\n  <span class=\"token keyword\">const</span> color <span class=\"token operator\">=</span> newcontainers<span class=\"token punctuation\">[</span>source<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">pop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// Push it onto the target container</span>\n  newcontainers<span class=\"token punctuation\">[</span>target<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>color<span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// If the next element in the source container is the same color, pour again</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>newcontainers<span class=\"token punctuation\">[</span>source<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>newcontainers<span class=\"token punctuation\">[</span>source<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> color<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">pour</span><span class=\"token punctuation\">(</span>newcontainers<span class=\"token punctuation\">,</span> source<span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> newcontainers\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>With my code so far, I can represent the game state, pour liquid from one container to another, and check if I’ve won or not, nice!</p>\n<p>Now I need to write code that can determine what possible moves I can make. To put it another way, given a container, what other containers can I pour it into? This is actually a harder problem then it first appears, and the reason for this is that there are a number of game states, where a legal move can be made, but it doesn’t advance the game. For example, if I have a container with two colors in it, and I pour it into an empty container, I haven’t changed the game state at all. I need to be able to detect these situations and ignore them. When I initially built my solver, I hadn’t considered this, and it would get stuck in an infinite loop!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e826e27339933a966f5b567f13fc5bf4/799f3/loop-state.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA90lEQVR42iWMb0vCUBhH9/0/QL0NArGiN2VUhISSqSz/FEGCmy4QttQZMzbv7r3PTrf14vDAefgdjyKBnxD2c4zWiFSAdWhHiTHG3Yo8FzZrTSUa7ZwVcbpyf00Sa1RpnbN4y1HI6+2YydUQpf4jQWiYTOFlhAuZ2vm+cNakjitlHIrioMkVHB9BmlrX13jjXsbdxYZWI+ZQlPXgbZBycxrROv8m753Absr8o+S+EeJ3UvJBA/nsEseGfivgurkl61/Cso0n6xkSPSOLLrpUyF9yG2KXT9jVCJk/QLZC9gkm6KAWzgVtql2IFBlq9oiJhm7fofp65xcwUSiJ8SrFtgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Looping state\"\n        title=\"\"\n        src=\"/static/e826e27339933a966f5b567f13fc5bf4/fcda8/loop-state.png\"\n        srcset=\"/static/e826e27339933a966f5b567f13fc5bf4/12f09/loop-state.png 148w,\n/static/e826e27339933a966f5b567f13fc5bf4/e4a3f/loop-state.png 295w,\n/static/e826e27339933a966f5b567f13fc5bf4/fcda8/loop-state.png 590w,\n/static/e826e27339933a966f5b567f13fc5bf4/efc66/loop-state.png 885w,\n/static/e826e27339933a966f5b567f13fc5bf4/c83ae/loop-state.png 1180w,\n/static/e826e27339933a966f5b567f13fc5bf4/799f3/loop-state.png 1642w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><em>The figure above shows how you can end up in a state where legitimate moves are made, but the game will loop infinitely</em></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">pourTargets</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">containers<span class=\"token punctuation\">,</span> source</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> sourceClone <span class=\"token operator\">=</span> containers<span class=\"token punctuation\">[</span>source<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> color <span class=\"token operator\">=</span> containers<span class=\"token punctuation\">[</span>source<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>containers<span class=\"token punctuation\">[</span>source<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>color<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">let</span> num <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> hue <span class=\"token keyword\">of</span> sourceClone<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hue <span class=\"token operator\">===</span> color<span class=\"token punctuation\">)</span> num<span class=\"token operator\">++</span>\n    <span class=\"token keyword\">else</span> <span class=\"token keyword\">break</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> secondColor <span class=\"token operator\">=</span> containers<span class=\"token punctuation\">[</span>source<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>containers<span class=\"token punctuation\">[</span>source<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">const</span> stackedColor <span class=\"token operator\">=</span> color <span class=\"token operator\">===</span> secondColor\n  <span class=\"token keyword\">const</span> targets <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> containers<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>source <span class=\"token operator\">===</span> j<span class=\"token punctuation\">)</span> <span class=\"token keyword\">continue</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>containers<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">continue</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>containers<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// This avoids the situation where you pour a stack of colors into an empty tube back and forth</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>containers<span class=\"token punctuation\">[</span>source<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">every</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">c</span> <span class=\"token operator\">=></span> c <span class=\"token operator\">===</span> color<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">continue</span>\n\n      targets<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">continue</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> comparator1 <span class=\"token operator\">=</span> containers<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>containers<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">const</span> comparator2 <span class=\"token operator\">=</span> containers<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>containers<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n    <span class=\"token comment\">// This avoids the situation where you continually pour the same color back and forth</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>color <span class=\"token operator\">===</span> comparator1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// This avoids the situation where you pour a stack of colors into a tube an leave some color remaining</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>num <span class=\"token operator\">+</span> containers<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">continue</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>comparator2 <span class=\"token operator\">&amp;&amp;</span> stackedColor <span class=\"token operator\">&amp;&amp;</span> comparator1 <span class=\"token operator\">===</span> comparator2<span class=\"token punctuation\">)</span> <span class=\"token keyword\">continue</span>\n\n      targets<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> targets\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The code above is a bit complicated, but it’s not too bad. The first thing I do is create a clone of the source container. I then count how many units of the same color are in the container. This is important because I don’t want to pour a stack of colors into a container and have leftovers (one of the failure modes we can hit). I then loop through all the containers and check if I can pour into them. If the container is empty, I check if the source container is all the same color. If it is, I skip it. This avoids the situation where you pour a stack of colors into an empty container back and forth. I then check if the last element in the target container is the same color as the source container. If it is, I check if the second to last element is the same color. If it is, I skip it. This avoids the situation where you continually pour the same color back and forth. I also check if the target container is full. If it is, I skip it. Finally, I check if the number of units of the same color in the source container plus the number of units in the target container is greater than 4. If it is, I skip it. This avoids the situation where you pour a stack of colors into a container and leave some color remaining.</p>\n<p>Phew, this is probably some of the hardest logic so far. I’m glad I got it working! The next step is to write the code that can search for the solution. At each step of the game, we can have multiple options to choose from, that can lead to different outcomes. We need to search all of these options to find the solution. If we mapped all the possible moves we would have a tree of different game states, where each state branches into one or more new states, until we either win, lose or arrive in a looping scenario. Searching tree-like data structures is a classic problem in computer science, and for this problem I chose to use an approach called <a href=\"https://en.wikipedia.org/wiki/Depth-first_search\">depth-first search</a>. This is an algorithm that starts at the root node and explores as far as possible along each branch before backtracking. I chose this approach because it’s simple to implement, and I don’t need to worry about the performance of the algorithm. I’m not searching a large tree, so I don’t need to worry about optimizing the search.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">isGameOver</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">containers</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> containers<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">pourTargets</span><span class=\"token punctuation\">(</span>containers<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">runDFS</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">containers</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Validate the input containers</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> container <span class=\"token keyword\">of</span> containers<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Invalid containers, size cannot be greater than 4'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> initialcontainers <span class=\"token operator\">=</span> containers\n\n  <span class=\"token comment\">// Use a stack for DFS, and initialize it with the initial state</span>\n  <span class=\"token keyword\">const</span> stack <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">containers</span><span class=\"token operator\">:</span> initialcontainers<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">moves</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>stack<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> containers<span class=\"token punctuation\">,</span> moves <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> stack<span class=\"token punctuation\">.</span><span class=\"token function\">pop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isGameOver</span><span class=\"token punctuation\">(</span>containers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">continue</span>\n\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> containers<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> targets <span class=\"token operator\">=</span> <span class=\"token function\">pourTargets</span><span class=\"token punctuation\">(</span>containers<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> targets<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> newcontainers <span class=\"token operator\">=</span> <span class=\"token function\">pour</span><span class=\"token punctuation\">(</span>containers<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">,</span> targets<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">const</span> newMoves <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>moves<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">from</span><span class=\"token operator\">:</span> i<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">to</span><span class=\"token operator\">:</span> targets<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isWin</span><span class=\"token punctuation\">(</span>newcontainers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>newMoves<span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">return</span>\n        <span class=\"token punctuation\">}</span>\n\n        stack<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">containers</span><span class=\"token operator\">:</span> newcontainers<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">moves</span><span class=\"token operator\">:</span> newMoves <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'No solution found'</span><span class=\"token punctuation\">)</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>stack<span class=\"token punctuation\">.</span><span class=\"token function\">pop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>moves<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now I can call <code class=\"language-text\">runDFS</code> with the initial state of the game, and it will search for a solution. If it finds one, it will print it to the console. If it doesn’t find one, it will print a message saying so. The output will be a series of instructions stating which container to pour from and what container to pour into, which I can then follow to win the game.</p>\n<p>Using our initial problem:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> problem <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token constant\">ORANGE</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">BLUE</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ORANGE</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">BLUE</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">BLUE</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ORANGE</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">BLUE</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ORANGE</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n<span class=\"token function\">runDFS</span><span class=\"token punctuation\">(</span>problem<span class=\"token punctuation\">)</span></code></pre></div>\n<p>I get the following output:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> from: <span class=\"token number\">1</span>, to: <span class=\"token number\">2</span> <span class=\"token punctuation\">}</span>,\n  <span class=\"token punctuation\">{</span> from: <span class=\"token number\">0</span>, to: <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span>,\n  <span class=\"token punctuation\">{</span> from: <span class=\"token number\">2</span>, to: <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span>,\n  <span class=\"token punctuation\">{</span> from: <span class=\"token number\">1</span>, to: <span class=\"token number\">2</span> <span class=\"token punctuation\">}</span>,\n  <span class=\"token punctuation\">{</span> from: <span class=\"token number\">0</span>, to: <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span>,\n  <span class=\"token punctuation\">{</span> from: <span class=\"token number\">2</span>, to: <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span>,\n  <span class=\"token punctuation\">{</span> from: <span class=\"token number\">1</span>, to: <span class=\"token number\">2</span> <span class=\"token punctuation\">}</span>,\n  <span class=\"token punctuation\">{</span> from: <span class=\"token number\">0</span>, to: <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span>,\n  <span class=\"token punctuation\">{</span> from: <span class=\"token number\">0</span>, to: <span class=\"token number\">2</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>Note that the containers are zero-indexed here, so <code class=\"language-text\">0</code> would be the first container.\nI can now follow these instructions step-by-step to solve the water-sort problem.</p>\n<p>What’s next? Although the logic is sound, setting up the game state and then following the solution is really awkward and error-prone. I’d really like to be able to streamline this process by adding a UI for the solver, but thats a problem for another post!</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"></code></pre></div>","frontmatter":{"title":"Solving Water Sort","date":"May 07, 2023"}}},"pageContext":{"slug":"/solving-water-sort/","previous":{"fields":{"slug":"/learning-to-code/"},"frontmatter":{"title":"How to Start Coding: A Practical Guide"}},"next":null}},"staticQueryHashes":[],"slicesMap":{}}