{"componentChunkName":"component---src-templates-blog-post-js","path":"/exploring-cryptography-frequency-analysis-pt3/","result":{"data":{"site":{"siteMetadata":{"title":"Living Life on the Outside","author":"Lucian Buzzo"}},"markdownRemark":{"id":"96306d2a-c57a-5cfa-af4e-4ea96455b94d","excerpt":"In part 2 I showed how you could crack a Caesar Cipher using frequency analysis alone. In this post I‚Äôm going to look at applying a similar‚Ä¶","html":"<p>In <a href=\"https://lucianbuzzo.com/exploring-cryptography-frequency-analysis-pt2/\">part 2</a> I showed how you could crack a Caesar Cipher using frequency analysis alone. In this post I‚Äôm going to look at applying a similar technique to crack simple substitution ciphers, where the cipher alphabet is not known ahead of time.</p>\n<p>A simple substitution cipher can be easily created using a pen and paper. First you write out each letter of the alphabet on a single line, then you shuffle the alphabet into a random order, and write the shuffled alphabet on the line below.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">abcdefghijklmnopqrstuvwxyz\nxahbjkystvqucmefzolwnpigrd</code></pre></div>\n<p>To encipher some text, you take the first character of the text, and find the corresponding character on the top line, and then write the character from the bottom line in the same position. You then repeat this process for the second character of the text, and so on. Using the example above, the text <code class=\"language-text\">hello</code> would be enciphered as <code class=\"language-text\">sjuue</code>. To decipher text, you perform the same process in reverse, starting by finding the character in the bottom line, and then writing the corresponding character from the top line in the same position. Note that you can use non alphabetical characters in the cipher text, as long as each character in the plain text alphabet corresponds to a single symbol, you can use anything you want - including emojis!</p>\n<p>Simple substitution ciphers are a lot more secure than the Caesar Cipher, but they are still relatively easy to crack using frequency analysis. Whilst they are not very useful for serious cryptography, I think they are a good on-ramp to a lot of the core ideas in cryptography and cryptanalysis, specifically how underlying patterns in the encoding structure can be exploited to ‚Äúbreak‚Äù the cipher.</p>\n<h2>The Cipher</h2>\n<p>To start with I‚Äôm going to create a simple cipher function that takes a string and a cipher alphabet and returns the encrypted string. The cipher alphabet is a permutation of the alphabet, so it‚Äôs a string of 26 unique characters. The cipher alphabet is generated by shuffling the alphabet, and then the first character of the cipher alphabet is used to replace the first character of the alphabet, the second character of the cipher alphabet is used to replace the second character of the alphabet, and so on.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">encipher</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>text<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> alphabet <span class=\"token operator\">=</span> <span class=\"token string\">'abcdefghijklmnopqrstuvwxyz'</span>\n  <span class=\"token keyword\">const</span> textArray <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> cipherArray <span class=\"token operator\">=</span> textArray<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>char <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> key<span class=\"token punctuation\">[</span>alphabet<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>char<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> cipherArray<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We can <a href=\"https://jestjs.io/\">write a simple test</a> to check that the cipher works as expected:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Simple Substitution Cipher'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should encode a string'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Classic Caesar Cipher (3)</span>\n    <span class=\"token keyword\">const</span> key <span class=\"token operator\">=</span> <span class=\"token string\">'defghijklmnopqrstuvwxyzabc'</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">encipher</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'khoor'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Next I want to create a function that will decipher the text, using the same key. This is a simple function that takes the cipher text and the key and returns the original text and is really just an inversion of the <code class=\"language-text\">encipher</code> function.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">decipher</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ciphertext<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> alphabet <span class=\"token operator\">=</span> <span class=\"token string\">'abcdefghijklmnopqrstuvwxyz'</span>\n  <span class=\"token keyword\">const</span> cipherTextArray <span class=\"token operator\">=</span> ciphertext<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> plainArray <span class=\"token operator\">=</span> cipherTextArray<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>char <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> alphabet<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>char<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> plainArray<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Again, I‚Äôm going to write some basic tests to check that the decipher function works as expected:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should decode a string'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> key <span class=\"token operator\">=</span> <span class=\"token string\">'defghijklmnopqrstuvwxyzabc'</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">decipher</span><span class=\"token punctuation\">(</span><span class=\"token string\">'khoor'</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'encode then decode should result in the same value'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> key <span class=\"token operator\">=</span> <span class=\"token string\">'defghijklmnopqrstuvwxyzabc'</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">decipher</span><span class=\"token punctuation\">(</span><span class=\"token function\">encipher</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Key Generation</h2>\n<p>One thing that I noticed straight away here is that the key feels very cumbersome to work with. It‚Äôs a string of 26 unique characters, which is hard to remember, and it‚Äôs also hard to type.\nInstead of having to define a whole 26 character key that is then used as the cipher alphabet, I‚Äôd like to be able to generate the cipher alphabet using a shorter key. To do this, I‚Äôm going to take advantage of a PRNG (pseudo random number generator) to generate a random permutation of the alphabet. I can then use a short phrase, word or number as the key, which will be the seed for the PRNG.</p>\n<p>A PRNG is a function that takes a seed value and returns a sequence of numbers that appear random. The sequence of numbers that are returned by the PRNG are deterministic, so if you use the same seed value you will always get the same sequence of numbers. Anyone familiar with Minecraft will be familiar with the concept of a PRNG, as Minecraft uses a PRNG to generate the world from a known seed. When you start a new world in Minecraft you can enter a seed value, and the world will be generated using a PRNG started from that seed. This is convenient, because if you enter the same seed value you will always get the same world. Note that this is possible because Minecraft worlds are procedurally generated using a PRNG, and not because the world is stored in a database somewhere.\nFor our use case, using a PRNG means that if you use the same seed value you will always get the same cipher alphabet and when we want to decipher the text we can use the same seed value to generate the same cipher alphabet for the deciphering process. The PRNG I‚Äôm going to use is the <a href=\"https://en.wikipedia.org/wiki/Mersenne_Twister\">Mersenne Twister</a> algorithm (provided by <a href=\"https://www.npmjs.com/package/random-js\"><code class=\"language-text\">random-js</code></a>, which is a very popular PRNG that is used in many programming languages. The Mersenne Twister is not cryptographically secure, but it is good enough for our purposes as we are not trying to generate secure keys, just keys that are easy to remember.</p>\n<p>The function is pretty simple, it takes an input key, which is converted to a 32 bit integer, and then used as the seed for the PRNG. We then use the PRNG to generate random numbers, which we use to find a random character from the alphabet by taking the modulus of the random number and the length of the alphabet. We then add that character to the cipher alphabet if it is not already present (remember the cipher alphabet must be unique!). This process is repeated until the cipher alphabet is the same length as the alphabet, resulting in a random permutation of the alphabet.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> stringTo32BitInteger <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>str<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> hash <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> str<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> charCode <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">charCodeAt</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n    hash <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>hash <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> hash <span class=\"token operator\">+</span> charCode\n    hash <span class=\"token operator\">|=</span> <span class=\"token number\">0</span> <span class=\"token comment\">// Convert to a 32-bit integer</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> hash\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generateCipherAlphabetFromKey</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> seed <span class=\"token operator\">=</span> <span class=\"token function\">stringTo32BitInteger</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> twister <span class=\"token operator\">=</span> MersenneTwister19937<span class=\"token punctuation\">.</span><span class=\"token function\">seed</span><span class=\"token punctuation\">(</span>seed<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> alphabet <span class=\"token operator\">=</span> <span class=\"token string\">'abcdefghijklmnopqrstuvwxyz'</span>\n  <span class=\"token keyword\">const</span> alphabetArray <span class=\"token operator\">=</span> alphabet<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> cipherAlphabet<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>cipherAlphabet<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&lt;</span> alphabetArray<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> int <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span>twister<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> index <span class=\"token operator\">=</span> int <span class=\"token operator\">%</span> alphabet<span class=\"token punctuation\">.</span>length\n    <span class=\"token keyword\">const</span> char <span class=\"token operator\">=</span> alphabetArray<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>cipherAlphabet<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>char<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      cipherAlphabet<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>char<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> cipherAlphabet<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I can now use this function to generate a cipher alphabet from a key, and then use that cipher alphabet to encipher and decipher text. Let‚Äôs plug in the new alphabet generator to the <code class=\"language-text\">encipher</code> and <code class=\"language-text\">decipher</code> functions:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">encipher</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>text<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> alphabet <span class=\"token operator\">=</span> <span class=\"token string\">'abcdefghijklmnopqrstuvwxyz'</span>\n  <span class=\"token keyword\">const</span> cipherAlphabet <span class=\"token operator\">=</span> <span class=\"token function\">generateCipherAlphabetFromKey</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> textArray <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> cipherArray <span class=\"token operator\">=</span> textArray<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>char <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> cipherAlphabet<span class=\"token punctuation\">[</span>alphabet<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>char<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> cipherArray<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">decipher</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ciphertext<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> alphabet <span class=\"token operator\">=</span> <span class=\"token string\">'abcdefghijklmnopqrstuvwxyz'</span>\n  <span class=\"token keyword\">const</span> cipherAlphabet <span class=\"token operator\">=</span> <span class=\"token function\">generateCipherAlphabetFromKey</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> cipherTextArray <span class=\"token operator\">=</span> ciphertext<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> plainArray <span class=\"token operator\">=</span> cipherTextArray<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>char <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> alphabet<span class=\"token punctuation\">[</span>cipherAlphabet<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>char<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> plainArray<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I‚Äôll also update the tests to use the new key functionality:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should encode a string'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> key <span class=\"token operator\">=</span> <span class=\"token string\">'aardvark'</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">encipher</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'nbpph'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should decode a string'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> key <span class=\"token operator\">=</span> <span class=\"token string\">'aardvark'</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">decipher</span><span class=\"token punctuation\">(</span><span class=\"token string\">'nbpph'</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'encode then decode should result in the same value'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> key <span class=\"token operator\">=</span> <span class=\"token string\">'aardvark'</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">decipher</span><span class=\"token punctuation\">(</span><span class=\"token function\">encipher</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Nice! We now have a working simple substitution cipher that can use an arbitrary key to encrpyt and decrypt text. The next step is to see if we can apply frequency analysis to this cipher to break it üòà.</p>\n<h2>Cracking the Cipher</h2>\n<p>I‚Äôm going to start with the same base frequency data that I used previously:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token constant\">STANDARD_FREQUENCIES</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token number\">0.0812</span><span class=\"token punctuation\">,</span>\n  b<span class=\"token operator\">:</span> <span class=\"token number\">0.0149</span><span class=\"token punctuation\">,</span>\n  c<span class=\"token operator\">:</span> <span class=\"token number\">0.0271</span><span class=\"token punctuation\">,</span>\n  d<span class=\"token operator\">:</span> <span class=\"token number\">0.0432</span><span class=\"token punctuation\">,</span>\n  e<span class=\"token operator\">:</span> <span class=\"token number\">0.1202</span><span class=\"token punctuation\">,</span>\n  f<span class=\"token operator\">:</span> <span class=\"token number\">0.023</span><span class=\"token punctuation\">,</span>\n  g<span class=\"token operator\">:</span> <span class=\"token number\">0.0203</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>\n  y<span class=\"token operator\">:</span> <span class=\"token number\">0.0211</span><span class=\"token punctuation\">,</span>\n  z<span class=\"token operator\">:</span> <span class=\"token number\">0.0007</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Then I‚Äôm going to create a <code class=\"language-text\">crack</code> function that will take a ciphertext and attempt to decode it using the following steps:</p>\n<ol>\n<li>Create a frequency map of the ciphertext</li>\n<li>For each character in the frequency map, find the character in the standard frequency map that has the closest frequency</li>\n<li>Create a cipher alphabet using the closest characters</li>\n<li>Use the cipher alphabet to decipher the ciphertext</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">crack</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>input<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> cipherText <span class=\"token operator\">=</span> input<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">[^a-z]</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// Create an object by iterating through the ALPHABET and setting each value to null</span>\n  <span class=\"token keyword\">const</span> cipherMap <span class=\"token operator\">=</span> <span class=\"token constant\">ALPHABET</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">,</span> char<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    obj<span class=\"token punctuation\">[</span>char<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n    <span class=\"token keyword\">return</span> obj\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> Record<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> cipherFrequency <span class=\"token operator\">=</span> <span class=\"token function\">frequencyAnalysis</span><span class=\"token punctuation\">(</span>cipherText<span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// Iterate through the STANDARD_FREQUENCIES and find the best match in the cipherFrequency</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>cipherMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> char <span class=\"token keyword\">in</span> <span class=\"token constant\">STANDARD_FREQUENCIES</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">let</span> bestMatch <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n      <span class=\"token keyword\">let</span> bestScore <span class=\"token operator\">=</span> <span class=\"token number\">Infinity</span>\n\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> cipherChar <span class=\"token keyword\">in</span> cipherFrequency<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> score <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span>\n          <span class=\"token punctuation\">(</span><span class=\"token constant\">STANDARD_FREQUENCIES</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>char<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> cipherFrequency<span class=\"token punctuation\">[</span>cipherChar<span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>score <span class=\"token operator\">&lt;</span> bestScore <span class=\"token operator\">&amp;&amp;</span> cipherMap<span class=\"token punctuation\">[</span>cipherChar<span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          bestScore <span class=\"token operator\">=</span> score\n          bestMatch <span class=\"token operator\">=</span> cipherChar\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bestMatch<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">;</span><span class=\"token punctuation\">(</span>cipherMap <span class=\"token keyword\">as</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>bestMatch<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> char\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Create the cipher alphabet</span>\n  <span class=\"token keyword\">const</span> cipherAlphabet <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>cipherMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// Decipher the cipher text</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">processText</span><span class=\"token punctuation\">(</span>cipherText<span class=\"token punctuation\">,</span> <span class=\"token constant\">ALPHABET</span><span class=\"token punctuation\">,</span> cipherAlphabet<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This works spectacularly badly! Even with relatively large plaintext (4000+ characters), it‚Äôs only able to decipher a few characters correctly. I think the problem is that the single character frequency analysis is too fine grained. Most of the standard letter frequencies you find are compiled from very large sets of text, often over 50k words, and the frequencies are averaged out. In the smaller blocks of text I‚Äôm using, the frequencies can be quite different, and the single character frequency analysis is not able to find the correct matches. The variability of letter frequencies in small blocks of text is just too high for this approach to work.\nI need to find a better approach, one that can better exploit the patterns in the English language, and work with smaller and more varied blocks of text.</p>\n<h2>Quadgrams</h2>\n<p>The approach I‚Äôm going to try will use quadgrams. A quadgram (also known as a 4-gram) is a continuous sequence of four characters from a given text. In the context of cracking codes, they can be useful for finding patterns in text and measuring how accurate a deciphering attempt is By comparing the frequency distribution of quadgrams in the decrypted text to a known distribution of quadgrams in the target language (e.g., English), you can estimate how likely it is that the decrypted text is meaningful and correctly decrypted.</p>\n<p>For example, in the text ‚Äúhello world‚Äù, the quadgrams are:</p>\n<ul>\n<li>‚Äúhell‚Äù</li>\n<li>‚Äúello‚Äù</li>\n<li>‚Äúllo ‚Äù</li>\n<li>‚Äúlo w‚Äù</li>\n<li>‚Äúo wo‚Äù</li>\n<li>‚Äù wor‚Äù</li>\n<li>‚Äúworl‚Äù</li>\n<li>‚Äúorld‚Äù</li>\n</ul>\n<p>By looking at lots and lots of English text, you can obtain frequency counts for quadgrams in English. You can then use this information to score a decrypted text based on how closely its quadgram frequencies match those of the English language.\nEssentially we‚Äôre going to use the same approach as before, but instead of comparing the frequency of individual characters, we‚Äôre going to compare the frequency of larger structures of text (quadgrams).</p>\n<p>I‚Äôm going to be using the quadgrams from the practical cryptography website, which you can find <a href=\"http://practicalcryptography.com/cryptanalysis/text-characterisation/quadgrams/\">here</a>. I‚Äôve downloaded the file and put it in the <code class=\"language-text\">src</code> directory. I‚Äôm going to use the <code class=\"language-text\">fs</code> module to read the file and create a map of quadgrams and their frequencies:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> readFileSync <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">loadQuadgramData</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>filename<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> fileContent <span class=\"token operator\">=</span> <span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> lines <span class=\"token operator\">=</span> fileContent<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> quadgramMap<span class=\"token operator\">:</span> Record<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">number</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> line <span class=\"token keyword\">of</span> lines<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>quadgram<span class=\"token punctuation\">,</span> frequency<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span>\n    quadgramMap<span class=\"token punctuation\">[</span>quadgram<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>frequency<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> quadgramMap\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">QUADGRAMS_FILE</span> <span class=\"token operator\">=</span> <span class=\"token string\">'./english_quadgrams.txt'</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">QUADGRAMS</span> <span class=\"token operator\">=</span> <span class=\"token function\">loadQuadgramData</span><span class=\"token punctuation\">(</span><span class=\"token constant\">QUADGRAMS_FILE</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>I‚Äôm then going to repeatedly different combinations of the cipher alphabet, scoring them based on the quadgram frequencies, if the score is higher than the previous best score, I‚Äôll keep the new score and cipher alphabet. This approach is sometimes called a ‚Äúhill-climbing‚Äù algorithm, because it‚Äôs like climbing a hill, and you‚Äôre always trying to find the highest point. You retain results that move you ‚Äúup the hill‚Äù, but discard results that move you ‚Äúdown the hill‚Äù. This is a very simple approach, but it works surprisingly well in practice, despite having some drawbacks like getting stuck in a local maximum.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">quadgramScore</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>text<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> score <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  <span class=\"token keyword\">const</span> cleanedText <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">[^a-z]</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> cleanedText<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> quadgram <span class=\"token operator\">=</span> cleanedText<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> i <span class=\"token operator\">+</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> quadgramFrequency <span class=\"token operator\">=</span> <span class=\"token constant\">QUADGRAMS</span><span class=\"token punctuation\">[</span>quadgram<span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> <span class=\"token number\">0</span>\n    score <span class=\"token operator\">+=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>quadgramFrequency <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> score\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">crack</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>cipherText<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Remove non-alphabetic characters and convert to lowercase</span>\n  <span class=\"token keyword\">const</span> cleanedCipherText <span class=\"token operator\">=</span> cipherText<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">[^a-z]</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// Function to swap two characters in a string at positions i and j</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">swapPositions</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>str<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> i<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> j<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> chars <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">;</span><span class=\"token punctuation\">[</span>chars<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> chars<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>chars<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> chars<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">return</span> chars<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Function to get a random integer between min and max (inclusive)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getRandomInt</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>min<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> max<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>max <span class=\"token operator\">-</span> min <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> min\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Set the maximum number of iterations for the hill-climbing algorithm</span>\n  <span class=\"token keyword\">const</span> <span class=\"token constant\">MAX_ITERATIONS</span> <span class=\"token operator\">=</span> <span class=\"token number\">10000</span>\n\n  <span class=\"token comment\">// Generate a random initial alphabet as the starting point</span>\n  <span class=\"token keyword\">let</span> bestAlphabet <span class=\"token operator\">=</span> <span class=\"token constant\">ALPHABET</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// Decrypt the text using the initial alphabet and calculate its quadgram score</span>\n  <span class=\"token keyword\">let</span> bestText <span class=\"token operator\">=</span> <span class=\"token function\">processText</span><span class=\"token punctuation\">(</span>cleanedCipherText<span class=\"token punctuation\">,</span> <span class=\"token constant\">ALPHABET</span><span class=\"token punctuation\">,</span> bestAlphabet<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">let</span> bestScore <span class=\"token operator\">=</span> <span class=\"token function\">quadgramScore</span><span class=\"token punctuation\">(</span>bestText<span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// Iterate through the hill-climbing algorithm</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> iteration <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> iteration <span class=\"token operator\">&lt;</span> <span class=\"token constant\">MAX_ITERATIONS</span><span class=\"token punctuation\">;</span> iteration<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Get two random positions in the alphabet</span>\n    <span class=\"token keyword\">const</span> i <span class=\"token operator\">=</span> <span class=\"token function\">getRandomInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">25</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> j <span class=\"token operator\">=</span> <span class=\"token function\">getRandomInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">25</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// Swap characters at the random positions in the current best alphabet</span>\n    <span class=\"token keyword\">const</span> newAlphabet <span class=\"token operator\">=</span> <span class=\"token function\">swapPositions</span><span class=\"token punctuation\">(</span>bestAlphabet<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// Decrypt the text using the new alphabet and calculate its quadgram score</span>\n    <span class=\"token keyword\">const</span> newText <span class=\"token operator\">=</span> <span class=\"token function\">processText</span><span class=\"token punctuation\">(</span>cleanedCipherText<span class=\"token punctuation\">,</span> <span class=\"token constant\">ALPHABET</span><span class=\"token punctuation\">,</span> newAlphabet<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> newScore <span class=\"token operator\">=</span> <span class=\"token function\">quadgramScore</span><span class=\"token punctuation\">(</span>newText<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// If the new quadgram score is better, update the best alphabet, text, and score</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>newScore <span class=\"token operator\">></span> bestScore<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      bestAlphabet <span class=\"token operator\">=</span> newAlphabet\n      bestText <span class=\"token operator\">=</span> newText\n      bestScore <span class=\"token operator\">=</span> newScore\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Decipher the original cipher text using the best alphabet found</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">processText</span><span class=\"token punctuation\">(</span>cipherText<span class=\"token punctuation\">,</span> <span class=\"token constant\">ALPHABET</span><span class=\"token punctuation\">,</span> bestAlphabet<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This performs remarkably well! When you use quadgrams in frequency analysis, you‚Äôre taking into account not only the frequency of individual letters but also the likelihood of specific letter combinations appearing together. This allows you to better exploit the patterns found in the English language and provides a more accurate representation of the language‚Äôs structure.\nMy implementation here will occasionally fail, but it‚Äôs usually able to decipher the text correctly. We can increase the max iterations value to make it more reliable, but I‚Äôve found that 10k is a good balance between speed and reliability (this version got about 85% accuracy in my testing).\nIt‚Äôs also worth noting that this algorithm is not the fastest, taking about 30 seconds to run on my mid-range laptop. This is because it‚Äôs using a brute-force approach to find the best cipher alphabet. There are more efficient algorithms that can be used to find the best cipher alphabet, but they‚Äôre beyond the scope of this article.</p>\n<p>Whilst you can use different n-grams, quadgrams are favored because they strike a balance between computational efficiency and accuracy. When you go from a quadgram to a 5-gram the number of possible combinations increases exponentially. For example, with a 26-character alphabet, there are 26^4 = 456,976 quadgrams, but there are 26^5 = 11,881,376 5-grams. Additionally, the frequency of 5-grams is much lower than that of quadgrams, so the scoring function will be less accurate.</p>\n<p>If this article was interesting to you, I highly recommend that you play around with these ideas yourself:</p>\n<ul>\n<li>try creating your own cipher functions</li>\n<li>extend the code here to work with non alphabetic characters</li>\n<li>try using different n-grams to score the decrypted text</li>\n<li>try using a different algorithm to find the best cipher alphabet</li>\n</ul>\n<p>If you have any questions or comments, please let me know in the comments below, or hit me up on Twitter <a href=\"https://twitter.com/LucianBuzzo\">@LucianBuzzo</a>.</p>\n<p>You can find the full source code for this post <a href=\"https://github.com/LucianBuzzo/simple-substitution-cipher\">here</a>.</p>\n<h2>Further reading</h2>\n<ul>\n<li><a href=\"http://practicalcryptography.com/cryptanalysis/text-characterisation/quadgrams/\">Practical Cryptography: Quadgrams</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Substitution_cipher\">Wikipedia: Substitution cipher</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Frequency_analysis\">Wikipedia: Frequency Analysis</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Hill_climbing\">Wikipedia: Hill Climbing</a></li>\n</ul>","frontmatter":{"title":"Exploring Cryptography - Frequency Analysis pt.3","date":"April 02, 2023"}}},"pageContext":{"slug":"/exploring-cryptography-frequency-analysis-pt3/","previous":{"fields":{"slug":"/exploring-cryptography-frequency-analysis-pt2/"},"frontmatter":{"title":"Exploring Cryptography - Frequency Analysis pt.2"}},"next":{"fields":{"slug":"/lazy-engineers/"},"frontmatter":{"title":"Are Good Engineers Lazy?"}}}},"staticQueryHashes":[],"slicesMap":{}}